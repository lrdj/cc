"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7365],{11726:function(e,t,r){r.d(t,{BB:function(){return f},F5:function(){return v},Mx:function(){return k},U2:function(){return u},Vq:function(){return E},dK:function(){return w},eT:function(){return d},jR:function(){return g},lV:function(){return function e(t,r,n=[]){return null!==t&&Array.isArray(t)?t.map((t,i)=>{if(S(t)){let s=t._key;if("string"==typeof s)return e(t,r,n.concat({_key:s,_index:i}))}return e(t,r,n.concat(i))}):S(t)?Object.fromEntries(Object.entries(t).map(([t,i])=>[t,e(i,r,n.concat(t))])):r(t,n)}},tZ:function(){return $},vs:function(){return y},wC:function(){return b}});let n=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,i=/_key\s*==\s*['"](.*)['"]/,s=/^\d*:\d*$/;function o(e){return"number"==typeof e||"string"==typeof e&&/^\[\d+\]$/.test(e)}function a(e){return"string"==typeof e?i.test(e.trim()):"object"==typeof e&&"_key"in e}function l(e){if("string"==typeof e&&s.test(e))return!0;if(!Array.isArray(e)||2!==e.length)return!1;let[t,r]=e;return("number"==typeof t||""===t)&&("number"==typeof r||""===r)}function u(e,t,r){let n="string"==typeof t?c(t):t;if(!Array.isArray(n))throw Error("Path must be an array or a string");let i=e;for(let e=0;e<n.length;e++){let t=n[e];if(o(t)){if(!Array.isArray(i))return r;i=i[t]}if(a(t)){if(!Array.isArray(i))return r;i=i.find(e=>e._key===t._key)}if("string"==typeof t&&(i="object"==typeof i&&null!==i?i[t]:void 0),typeof i>"u")return r}return i}function f(e){if(!Array.isArray(e))throw Error("Path is not an array");return e.reduce((e,t,r)=>{let n=typeof t;if("number"===n)return`${e}[${t}]`;if("string"===n)return`${e}${0===r?"":"."}${t}`;if(a(t)&&t._key)return`${e}[_key=="${t._key}"]`;if(Array.isArray(t)){let[r,n]=t;return`${e}[${r}:${n}]`}throw Error(`Unsupported path segment \`${JSON.stringify(t)}\``)},"")}function c(e){if("string"!=typeof e)throw Error("Path is not a string");let t=e.match(n);if(!t)throw Error("Invalid path string");return t.map(h)}function h(e){return o(e)?Number(e.replace(/[^\d]/g,"")):a(e)?{_key:e.match(i)[1]}:l(e)?function(e){let[t,r]=e.split(":").map(e=>""===e?e:Number(e));return[t,r]}(e):e}var d=Object.freeze({__proto__:null,fromString:c,get:u,isIndexSegment:o,isIndexTuple:l,isKeySegment:a,reKeySegment:i,toString:f});let g="drafts.";function y(e){return e.startsWith(g)?e.slice(g.length):e}let p={"\f":"\\f","\n":"\\n","\r":"\\r","	":"\\t","'":"\\'","\\":"\\\\"},m={"\\f":"\f","\\n":`
`,"\\r":"\r","\\t":"	","\\'":"'","\\\\":"\\"};function v(e){let t;let r=[],n=/\['(.*?)'\]|\[(\d+)\]|\[\?\(@\._key=='(.*?)'\)\]/g;for(;null!==(t=n.exec(e));){if(void 0!==t[1]){let e=t[1].replace(/\\(\\|f|n|r|t|')/g,e=>m[e]);r.push(e);continue}if(void 0!==t[2]){r.push(parseInt(t[2],10));continue}if(void 0!==t[3]){let e=t[3].replace(/\\(\\')/g,e=>m[e]);r.push({_key:e,_index:-1});continue}}return r}function b(e){return e.map(e=>{if("string"==typeof e||"number"==typeof e)return e;if(""!==e._key)return{_key:e._key};if(-1!==e._index)return e._index;throw Error(`invalid segment:${JSON.stringify(e)}`)})}function w(e){return("string"==typeof e?c(e):e).map(e=>{if("string"==typeof e||"number"==typeof e)return e;if(Array.isArray(e))throw Error(`IndexTuple segments aren't supported:${JSON.stringify(e)}`);if("object"==typeof e&&"_key"in e&&"_index"in e)return e;if(e._key)return{_key:e._key,_index:-1};throw Error(`invalid segment:${JSON.stringify(e)}`)})}function k(e,t){var r;if(!(null!=t&&t.mappings))return;let n=(r=e.map(e=>{if("string"==typeof e||"number"==typeof e)return e;if(-1!==e._index)return e._index;throw Error(`invalid segment:${JSON.stringify(e)}`)}),`$${r.map(e=>"string"==typeof e?`['${e.replace(/[\f\n\r\t'\\]/g,e=>p[e])}']`:"number"==typeof e?`[${e}]`:""!==e._key?`[?(@._key=='${e._key.replace(/['\\]/g,e=>p[e])}')]`:`[${e._index}]`).join("")}`);if(void 0!==t.mappings[n])return{mapping:t.mappings[n],matchedPath:n,pathSuffix:""};let i=Object.entries(t.mappings).filter(([e])=>n.startsWith(e)).sort(([e],[t])=>t.length-e.length);if(0==i.length)return;let[s,o]=i[0],a=n.substring(s.length);return{mapping:o,matchedPath:s,pathSuffix:a}}function S(e){return"object"==typeof e&&null!==e}function $(e){let{baseUrl:t,workspace:r="default",tool:n="default",id:i,type:s,path:o,projectId:a,dataset:l}=e;if(!t)throw Error("baseUrl is required");if(!o)throw Error("path is required");if(!i)throw Error("id is required");if("/"!==t&&t.endsWith("/"))throw Error("baseUrl must not end with a slash");let u="default"===r?void 0:r,c="default"===n?void 0:n,h=y(i),d=Array.isArray(o)?f(b(o)):o,p=new URLSearchParams({baseUrl:t,id:h,type:s,path:d});u&&p.set("workspace",u),c&&p.set("tool",c),a&&p.set("projectId",a),l&&p.set("dataset",l),i.startsWith(g)&&p.set("isDraft","");let m=["/"===t?"":t];u&&m.push(u);let v=["mode=presentation",`id=${h}`,`type=${s}`,`path=${encodeURIComponent(d)}`];return c&&v.push(`tool=${c}`),m.push("intent","edit",`${v.join(";")}?${p}`),m.join("/")}function E(e){let{resultSourceMap:t,resultPath:r}=e,{mapping:n,pathSuffix:i}=k(r,t)||{};if(!n||"literal"===n.source.type||"unknown"===n.source.type)return;let s=t.documents[n.source.document],o=t.paths[n.source.path];if(s&&o){var a;let t;let{baseUrl:r,workspace:n,tool:l}=("/"!==(t="string"==typeof(a="function"==typeof e.studioUrl?e.studioUrl(s):e.studioUrl)?a:a.baseUrl)&&(t=t.replace(/\/$/,"")),"string"==typeof a?{baseUrl:t}:{...a,baseUrl:t});if(!r)return;let{_id:u,_type:f,_projectId:c,_dataset:h}=s;return{baseUrl:r,workspace:n,tool:l,id:u,type:f,path:v(o+i),projectId:c,dataset:h}}}},29104:function(e,t,r){let n,i;r.d(t,{a:function(){return et},c:function(){return ei}});var s,o={},a={kValues:Symbol("values"),kStorage:Symbol("kStorage"),kStorages:Symbol("kStorages"),kTransfromer:Symbol("kTransformer"),kTTL:Symbol("kTTL"),kOnDedupe:Symbol("kOnDedupe"),kOnError:Symbol("kOnError"),kOnHit:Symbol("kOnHit"),kOnMiss:Symbol("kOnMiss"),kStale:Symbol("kStale")},l={exports:{}};!function(e,t){let{hasOwnProperty:r}=Object.prototype,n=d();n.configure=d,n.stringify=n,n.default=n,t.stringify=n,t.configure=d,e.exports=n;let i=/[\u0000-\u001f\u0022\u005c\ud800-\udfff]|[\ud800-\udbff](?![\udc00-\udfff])|(?:[^\ud800-\udbff]|^)[\udc00-\udfff]/;function s(e){return e.length<5e3&&!i.test(e)?`"${e}"`:JSON.stringify(e)}function o(e){if(e.length>200)return e.sort();for(let t=1;t<e.length;t++){let r=e[t],n=t;for(;0!==n&&e[n-1]>r;)e[n]=e[n-1],n--;e[n]=r}return e}let a=Object.getOwnPropertyDescriptor(Object.getPrototypeOf(Object.getPrototypeOf(new Int8Array)),Symbol.toStringTag).get;function l(e){return void 0!==a.call(e)&&0!==e.length}function u(e,t,r){e.length<r&&(r=e.length);let n=","===t?"":" ",i=`"0":${n}${e[0]}`;for(let s=1;s<r;s++)i+=`${t}"${s}":${n}${e[s]}`;return i}function f(e,t){let n;if(r.call(e,t)&&"boolean"!=typeof(n=e[t]))throw TypeError(`The "${t}" argument must be of type boolean`);return void 0===n||n}function c(e,t){let n;if(r.call(e,t)){if("number"!=typeof(n=e[t]))throw TypeError(`The "${t}" argument must be of type number`);if(!Number.isInteger(n))throw TypeError(`The "${t}" argument must be an integer`);if(n<1)throw RangeError(`The "${t}" argument must be >= 1`)}return void 0===n?1/0:n}function h(e){return 1===e?"1 item":`${e} items`}function d(e){let t=function(e){if(r.call(e,"strict")){let t=e.strict;if("boolean"!=typeof t)throw TypeError('The "strict" argument must be of type boolean');if(t)return e=>{let t="Object can not safely be stringified. Received type "+typeof e;throw"function"!=typeof e&&(t+=` (${e.toString()})`),Error(t)}}}(e={...e});t&&(void 0===e.bigint&&(e.bigint=!1),"circularValue"in e||(e.circularValue=Error));let n=function(e){if(r.call(e,"circularValue")){let t=e.circularValue;if("string"==typeof t)return`"${t}"`;if(null==t)return t;if(t===Error||t===TypeError)return{toString(){throw TypeError("Converting circular structure to JSON")}};throw TypeError('The "circularValue" argument must be of type string or the value null or undefined')}return'"[Circular]"'}(e),i=f(e,"bigint"),a=f(e,"deterministic"),d=c(e,"maximumDepth"),g=c(e,"maximumBreadth");return function(e,r,f){if(arguments.length>1){let c="";if("number"==typeof f?c=" ".repeat(Math.min(f,10)):"string"==typeof f&&(c=f.slice(0,10)),null!=r){if("function"==typeof r)return function e(r,u,f,c,y,p){let m=u[r];switch("object"==typeof m&&null!==m&&"function"==typeof m.toJSON&&(m=m.toJSON(r)),typeof(m=c.call(u,r,m))){case"string":return s(m);case"object":{if(null===m)return"null";if(-1!==f.indexOf(m))return n;let t="",r=",",i=p;if(Array.isArray(m)){if(0===m.length)return"[]";if(d<f.length+1)return'"[Array]"';f.push(m),""!==y&&(t+=`
${p+=y}`,r=`,
${p}`);let n=Math.min(m.length,g),s=0;for(;s<n-1;s++){let n=e(String(s),m,f,c,y,p);t+=(void 0!==n?n:"null")+r}let o=e(String(s),m,f,c,y,p);return t+=void 0!==o?o:"null",m.length-1>g&&(t+=`${r}"... ${h(m.length-g-1)} not stringified"`),""!==y&&(t+=`
${i}`),f.pop(),`[${t}]`}let u=Object.keys(m),v=u.length;if(0===v)return"{}";if(d<f.length+1)return'"[Object]"';let b="",w="";""!==y&&(r=`,
${p+=y}`,b=" ");let k=Math.min(v,g);a&&!l(m)&&(u=o(u)),f.push(m);for(let n=0;n<k;n++){let i=u[n],o=e(i,m,f,c,y,p);void 0!==o&&(t+=`${w}${s(i)}:${b}${o}`,w=r)}return v>g&&(t+=`${w}"...":${b}"${h(v-g)} not stringified"`,w=r),""!==y&&w.length>1&&(t=`
${p}${t}
${i}`),f.pop(),`{${t}}`}case"number":return isFinite(m)?String(m):t?t(m):"null";case"boolean":return!0===m?"true":"false";case"undefined":return;case"bigint":if(i)return String(m);default:return t?t(m):void 0}}("",{"":e},[],r,c,"");if(Array.isArray(r))return function e(r,o,a,l,u,f){switch("object"==typeof o&&null!==o&&"function"==typeof o.toJSON&&(o=o.toJSON(r)),typeof o){case"string":return s(o);case"object":{if(null===o)return"null";if(-1!==a.indexOf(o))return n;let t=f,r="",i=",";if(Array.isArray(o)){if(0===o.length)return"[]";if(d<a.length+1)return'"[Array]"';a.push(o),""!==u&&(r+=`
${f+=u}`,i=`,
${f}`);let n=Math.min(o.length,g),s=0;for(;s<n-1;s++){let t=e(String(s),o[s],a,l,u,f);r+=(void 0!==t?t:"null")+i}let c=e(String(s),o[s],a,l,u,f);return r+=void 0!==c?c:"null",o.length-1>g&&(r+=`${i}"... ${h(o.length-g-1)} not stringified"`),""!==u&&(r+=`
${t}`),a.pop(),`[${r}]`}a.push(o);let c="";""!==u&&(i=`,
${f+=u}`,c=" ");let y="";for(let t of l){let n=e(t,o[t],a,l,u,f);void 0!==n&&(r+=`${y}${s(t)}:${c}${n}`,y=i)}return""!==u&&y.length>1&&(r=`
${f}${r}
${t}`),a.pop(),`{${r}}`}case"number":return isFinite(o)?String(o):t?t(o):"null";case"boolean":return!0===o?"true":"false";case"undefined":return;case"bigint":if(i)return String(o);default:return t?t(o):void 0}}("",e,[],function(e){let t=new Set;for(let r of e)("string"==typeof r||"number"==typeof r)&&t.add(String(r));return t}(r),c,"")}if(0!==c.length)return function e(r,f,c,y,p){switch(typeof f){case"string":return s(f);case"object":{if(null===f)return"null";if("function"==typeof f.toJSON){if("object"!=typeof(f=f.toJSON(r)))return e(r,f,c,y,p);if(null===f)return"null"}if(-1!==c.indexOf(f))return n;let t=p;if(Array.isArray(f)){if(0===f.length)return"[]";if(d<c.length+1)return'"[Array]"';c.push(f);let r=`
${p+=y}`,n=`,
${p}`,i=Math.min(f.length,g),s=0;for(;s<i-1;s++){let t=e(String(s),f[s],c,y,p);r+=(void 0!==t?t:"null")+n}let o=e(String(s),f[s],c,y,p);return r+=void 0!==o?o:"null",f.length-1>g&&(r+=`${n}"... ${h(f.length-g-1)} not stringified"`),r+=`
${t}`,c.pop(),`[${r}]`}let i=Object.keys(f),m=i.length;if(0===m)return"{}";if(d<c.length+1)return'"[Object]"';let v=`,
${p+=y}`,b="",w="",k=Math.min(m,g);l(f)&&(b+=u(f,v,g),i=i.slice(f.length),k-=f.length,w=v),a&&(i=o(i)),c.push(f);for(let t=0;t<k;t++){let r=i[t],n=e(r,f[r],c,y,p);void 0!==n&&(b+=`${w}${s(r)}: ${n}`,w=v)}return m>g&&(b+=`${w}"...": "${h(m-g)} not stringified"`,w=v),""!==w&&(b=`
${p}${b}
${t}`),c.pop(),`{${b}}`}case"number":return isFinite(f)?String(f):t?t(f):"null";case"boolean":return!0===f?"true":"false";case"undefined":return;case"bigint":if(i)return String(f);default:return t?t(f):void 0}}("",e,[],c,"")}return function e(r,f,c){switch(typeof f){case"string":return s(f);case"object":{if(null===f)return"null";if("function"==typeof f.toJSON){if("object"!=typeof(f=f.toJSON(r)))return e(r,f,c);if(null===f)return"null"}if(-1!==c.indexOf(f))return n;let t="";if(Array.isArray(f)){if(0===f.length)return"[]";if(d<c.length+1)return'"[Array]"';c.push(f);let r=Math.min(f.length,g),n=0;for(;n<r-1;n++){let r=e(String(n),f[n],c);t+=(void 0!==r?r:"null")+","}let i=e(String(n),f[n],c);return t+=void 0!==i?i:"null",f.length-1>g&&(t+=`,"... ${h(f.length-g-1)} not stringified"`),c.pop(),`[${t}]`}let i=Object.keys(f),y=i.length;if(0===y)return"{}";if(d<c.length+1)return'"[Object]"';let p="",m=Math.min(y,g);l(f)&&(t+=u(f,",",g),i=i.slice(f.length),m-=f.length,p=","),a&&(i=o(i)),c.push(f);for(let r=0;r<m;r++){let n=i[r],o=e(n,f[n],c);void 0!==o&&(t+=`${p}${s(n)}:${o}`,p=",")}return y>g&&(t+=`${p}"...":"${h(y-g)} not stringified"`),c.pop(),`{${t}}`}case"number":return isFinite(f)?String(f):t?t(f):"null";case"boolean":return!0===f?"true":"false";case"undefined":return;case"bigint":if(i)return String(f);default:return t?t(f):void 0}}("",e,[])}}}(l,l.exports);var u=l.exports;function f(e){return e*Math.random()|0}var c,h,d={findNotMatching:function(e,t){let r=[],n=0;for(let i=0;i<e.length;i++)for(let s=n;s<t.length;s++)e[i]!==t[s]&&(r.push(t[s]),n=s+1);return r},findMatchingIndexes:function(e,t){let r=[],n=0;for(let i=0;i<e.length;i++)for(let s=n;s<t.length;s++)e[i]===t[s]&&(r.push(s),n=s+1);return r},bsearchIndex:function(e,t){let r=0,n=e.length-1;for(;r<=n;){let i=(r+n)/2|0;if(e[i]===t)return i;e[i]<t?r=i+1:n=i-1}return -1},wildcardMatch:function(e,t){if("*"===e||e.length===t.length&&e===t)return!0;let r=0,n=0;for(;r<e.length&&n<t.length;)if(e[r]!==t[n]){if("*"!==e[r])return!1;if(e[r+1]===t[n]){r++;continue}n++}else r++,n++;return r>=e.length-1},randomSubset:function(e,t){var r,n;if(e.length<1||t<1)return[];let i=(r=1,n=Math.min(e.length,t),(r=Math.floor(r))+f(1+(n=Math.floor(n))-r)),s=new Set;for(let t=0;t<i;t++)s.add(f(e.length));let o=[];for(let t of s)o.push(e[t]);return o},abstractLogging:function(){let e=()=>{};return{fatal:e,error:e,warn:e,info:e,debug:e,trace:e}},isServerSide:typeof window>"u"},g=class{constructor(e){this.options=e}async get(e){throw Error("storage get method not implemented")}async set(e,t,r,n){throw Error("storage set method not implemented")}async remove(e){throw Error("storage remove method not implemented")}async invalidate(e){throw Error("storage invalidate method not implemented")}async clear(e){throw Error("storage clear method not implemented")}async refresh(){throw Error("storage refresh method not implemented")}};function y(e){if("function"!=typeof e)throw Error("obliterator/iterator: expecting a function!");this.next=e}"u">typeof Symbol&&(y.prototype[Symbol.iterator]=function(){return this}),y.of=function(){var e=arguments,t=e.length,r=0;return new y(function(){return r>=t?{done:!0}:{done:!1,value:e[r++]}})},y.empty=function(){return new y(function(){return{done:!0}})},y.fromSequence=function(e){var t=0,r=e.length;return new y(function(){return t>=r?{done:!0}:{done:!1,value:e[t++]}})},y.is=function(e){return e instanceof y||"object"==typeof e&&null!==e&&"function"==typeof e.next};var p={};p.ARRAY_BUFFER_SUPPORT="u">typeof ArrayBuffer,p.SYMBOL_SUPPORT="u">typeof Symbol;var m=p.ARRAY_BUFFER_SUPPORT,v=p.SYMBOL_SUPPORT,b=function(e,t){var r,n,i,s,o;if(!e)throw Error("obliterator/forEach: invalid iterable.");if("function"!=typeof t)throw Error("obliterator/forEach: expecting a callback.");if(Array.isArray(e)||m&&ArrayBuffer.isView(e)||"string"==typeof e||"[object Arguments]"===e.toString())for(i=0,s=e.length;i<s;i++)t(e[i],i);else if("function"!=typeof e.forEach){if(v&&Symbol.iterator in e&&"function"!=typeof e.next&&(e=e[Symbol.iterator]()),"function"!=typeof e.next)for(n in e)e.hasOwnProperty(n)&&t(e[n],n);else for(r=e,i=0;!0!==(o=r.next()).done;)t(o.value,i),i++}else e.forEach(t)},w={};w.getPointerArray=function(e){var t=e-1;if(t<=255)return Uint8Array;if(t<=65535)return Uint16Array;if(t<=4294967295)return Uint32Array;throw Error("mnemonist: Pointer Array of size > 4294967295 is not supported.")},w.getSignedPointerArray=function(e){var t=e-1;return t<=127?Int8Array:t<=32767?Int16Array:t<=2147483647?Int32Array:Float64Array},w.getNumberType=function(e){return e===(0|e)?-1===Math.sign(e)?e<=127&&e>=-128?Int8Array:e<=32767&&e>=-32768?Int16Array:Int32Array:e<=255?Uint8Array:e<=65535?Uint16Array:Uint32Array:Float64Array},s={Uint8Array:1,Int8Array:2,Uint16Array:3,Int16Array:4,Uint32Array:5,Int32Array:6,Float32Array:7,Float64Array:8},w.getMinimalRepresentation=function(e,t){var r,n,i,o,a,l=null,u=0;for(o=0,a=e.length;o<a;o++)i=t?t(e[o]):e[o],(r=s[(n=w.getNumberType(i)).name])>u&&(u=r,l=n);return l},w.isTypedArray=function(e){return"u">typeof ArrayBuffer&&ArrayBuffer.isView(e)},w.concat=function(){var e,t,r,n=0;for(e=0,r=arguments.length;e<r;e++)n+=arguments[e].length;var i=new arguments[0].constructor(n);for(e=0,t=0;e<r;e++)i.set(arguments[e],t),t+=arguments[e].length;return i},w.indices=function(e){for(var t=new(w.getPointerArray(e))(e),r=0;r<e;r++)t[r]=r;return t};var k={};function S(e){return"number"==typeof e.length?e.length:"number"==typeof e.size?e.size:void 0}function $(e,t,r){if(arguments.length<2&&(r=e,e=null,t=null),this.capacity=r,"number"!=typeof this.capacity||this.capacity<=0)throw Error("mnemonist/lru-cache: capacity should be positive number.");if(!isFinite(this.capacity)||Math.floor(this.capacity)!==this.capacity)throw Error("mnemonist/lru-cache: capacity should be a finite positive integer.");var n=w.getPointerArray(r);this.forward=new n(r),this.backward=new n(r),this.K="function"==typeof e?new e(r):Array(r),this.V="function"==typeof t?new t(r):Array(r),this.size=0,this.head=0,this.tail=0,this.items={}}k.isArrayLike=function(e){return Array.isArray(e)||w.isTypedArray(e)},k.guessLength=S,k.toArray=function(e){var t=S(e),r="number"==typeof t?Array(t):[],n=0;return b(e,function(e){r[n++]=e}),r},k.toArrayWithIndices=function(e){var t=S(e),r="number"==typeof t?w.getPointerArray(t):Array,n="number"==typeof t?Array(t):[],i="number"==typeof t?new r(t):[],s=0;return b(e,function(e){n[s]=e,i[s]=s++}),[n,i]},$.prototype.clear=function(){this.size=0,this.head=0,this.tail=0,this.items={}},$.prototype.splayOnTop=function(e){var t=this.head;if(this.head===e)return this;var r=this.backward[e],n=this.forward[e];return this.tail===e?this.tail=r:this.backward[n]=r,this.forward[r]=n,this.backward[t]=e,this.head=e,this.forward[e]=t,this},$.prototype.set=function(e,t){var r=this.items[e];if("u">typeof r)return this.splayOnTop(r),void(this.V[r]=t);this.size<this.capacity?r=this.size++:(r=this.tail,this.tail=this.backward[r],delete this.items[this.K[r]]),this.items[e]=r,this.K[r]=e,this.V[r]=t,this.forward[r]=this.head,this.backward[this.head]=r,this.head=r},$.prototype.setpop=function(e,t){var r=null,n=null,i=this.items[e];return"u">typeof i?(this.splayOnTop(i),r=this.V[i],this.V[i]=t,{evicted:!1,key:e,value:r}):(this.size<this.capacity?i=this.size++:(i=this.tail,this.tail=this.backward[i],r=this.V[i],n=this.K[i],delete this.items[n]),this.items[e]=i,this.K[i]=e,this.V[i]=t,this.forward[i]=this.head,this.backward[this.head]=i,this.head=i,n?{evicted:!0,key:n,value:r}:null)},$.prototype.has=function(e){return e in this.items},$.prototype.get=function(e){var t=this.items[e];if(!(typeof t>"u"))return this.splayOnTop(t),this.V[t]},$.prototype.peek=function(e){var t=this.items[e];if(!(typeof t>"u"))return this.V[t]},$.prototype.forEach=function(e,t){t=arguments.length>1?t:this;for(var r=0,n=this.size,i=this.head,s=this.K,o=this.V,a=this.forward;r<n;)e.call(t,o[i],s[i],this),i=a[i],r++},$.prototype.keys=function(){var e=0,t=this.size,r=this.head,n=this.K,i=this.forward;return new y(function(){if(e>=t)return{done:!0};var s=n[r];return++e<t&&(r=i[r]),{done:!1,value:s}})},$.prototype.values=function(){var e=0,t=this.size,r=this.head,n=this.V,i=this.forward;return new y(function(){if(e>=t)return{done:!0};var s=n[r];return++e<t&&(r=i[r]),{done:!1,value:s}})},$.prototype.entries=function(){var e=0,t=this.size,r=this.head,n=this.K,i=this.V,s=this.forward;return new y(function(){if(e>=t)return{done:!0};var o=n[r],a=i[r];return++e<t&&(r=s[r]),{done:!1,value:[o,a]}})},"u">typeof Symbol&&($.prototype[Symbol.iterator]=$.prototype.entries),$.prototype.inspect=function(){for(var e,t=new Map,r=this.entries();!(e=r.next()).done;)t.set(e.value[0],e.value[1]);return Object.defineProperty(t,"constructor",{value:$,enumerable:!1}),t},"u">typeof Symbol&&($.prototype[Symbol.for("nodejs.util.inspect.custom")]=$.prototype.inspect),$.from=function(e,t,r,n){if(arguments.length<2){if("number"!=typeof(n=k.guessLength(e)))throw Error("mnemonist/lru-cache.from: could not guess iterable length. Please provide desired capacity as last argument.")}else 2==arguments.length&&(n=t,t=null,r=null);var i=new $(t,r,n);return b(e,function(e,t){i.set(t,e)}),i};let{abstractLogging:E}=d,_=g,{findMatchingIndexes:A,findNotMatching:O,bsearchIndex:R,wildcardMatch:T}=d,M="u">typeof globalThis.setImmediate?globalThis.setImmediate:(e,...t)=>setTimeout(e,0,...t);function x(){if(void 0!==n)return n;n=Math.floor(Date.now()/1e3);let e=setTimeout(K,1e3);return"function"==typeof e.unref&&e.unref(),n}function K(){n=void 0}var j=class extends _{constructor(e={}){if(e.size&&("number"!=typeof e.size||e.size<1))throw Error("size must be a positive integer greater than 0");super(e),this.size=e.size||1024,this.log=e.log||E(),this.invalidation=e.invalidation||!1,this.init()}init(){this.store=new $(this.size),this.invalidation&&(this.keysReferences=new Map,this.referencesKeys=new Map)}get(e){this.log.debug({msg:"acd/storage/memory.get",key:e});let t=this.store.get(e);if(t){if(this.log.debug({msg:"acd/storage/memory.get, entry",entry:t,now:x()}),t.start+t.ttl>x())return this.log.debug({msg:"acd/storage/memory.get, key is NOT expired",key:e,entry:t}),t.value;this.log.debug({msg:"acd/storage/memory.get, key is EXPIRED",key:e,entry:t}),M(()=>this.remove(e))}}getTTL(e){this.log.debug({msg:"acd/storage/memory.getTTL",key:e});let t=this.store.peek(e),r=0;return t&&(r=t.start+t.ttl-x())<0&&(r=0),r}set(e,t,r,n){let i;if(this.log.debug({msg:"acd/storage/memory.set",key:e,value:t,ttl:r,references:n}),!(r=Number(r))||r<0)return;let s=this.store.has(e),o=this.store.setpop(e,{value:t,ttl:r,start:x()});if(this.log.debug({msg:"acd/storage/memory.set, evicted",removed:o}),o&&o.evicted&&(this.log.debug({msg:"acd/storage/memory.set, remove evicted key",key:o.key}),this._removeReferences([o.key])),!n||n.length<1)return;if(!this.invalidation)return void this.log.warn({msg:"acd/storage/memory.set, invalidation is disabled, references are useless"});if(n=[...new Set(n)],s&&(i=this.keysReferences.get(e),this.log.debug({msg:"acd/storage/memory.set, current keys-references",key:e,references:i}),i))for(let t of(i.sort(),n.sort(),O(n,i))){let r=this.referencesKeys.get(t);if(!r)continue;let n=R(r,e);if(!(n<0)){if(r.splice(n,1),r.length<1){this.referencesKeys.delete(t);continue}this.referencesKeys.set(t,r)}}let a=i?O(i,n):n;for(let t=0;t<a.length;t++){let r=a[t],n=this.referencesKeys.get(r);n?(this.log.debug({msg:"acd/storage/memory.set, add reference-key",key:e,reference:r}),n.push(e)):n=[e],this.log.debug({msg:"acd/storage/memory.set, set reference-keys",keys:n,reference:r}),this.referencesKeys.set(r,n)}this.keysReferences.set(e,n)}remove(e){this.log.debug({msg:"acd/storage/memory.remove",key:e});let t=this._removeKey(e);return this._removeReferences([e]),t}_removeKey(e){return this.log.debug({msg:"acd/storage/memory._removeKey",key:e}),!!this.store.has(e)&&(this.store.set(e,void 0),!0)}_removeReferences(e){if(!this.invalidation)return;this.log.debug({msg:"acd/storage/memory._removeReferences",keys:e});let t=new Set;for(let r=0;r<e.length;r++){let n=e[r],i=this.keysReferences.get(n);if(i){for(let e=0;e<i.length;e++)t.add(i[e]);this.log.debug({msg:"acd/storage/memory._removeReferences, delete key-references",key:n}),this.keysReferences.delete(n)}}this._removeReferencesKeys([...t],e)}_removeReferencesKeys(e,t){t.sort(),this.log.debug({msg:"acd/storage/memory._removeReferencesKeys",references:e,keys:t});for(let r=0;r<e.length;r++){let n=e[r],i=this.referencesKeys.get(n);if(this.log.debug({msg:"acd/storage/memory._removeReferencesKeys, get reference-key",reference:n,keys:t,referencesKeys:i}),!i)continue;let s=A(t,i);if(this.log.debug({msg:"acd/storage/memory._removeReferencesKeys, removing",reference:n,referencesToRemove:s,referencesKeys:i}),s.length!==i.length)for(let e=s.length-1;e>=0;e--)this.log.debug({msg:"acd/storage/memory._removeReferencesKeys, remove",reference:n,referencesKeys:i,at:s[e]}),i.splice(s[e],1);else this.log.debug({msg:"acd/storage/memory._removeReferencesKeys, delete",reference:n}),this.referencesKeys.delete(n)}}invalidate(e){return this.invalidation?(this.log.debug({msg:"acd/storage/memory.invalidate",references:e}),Array.isArray(e)?this._invalidateReferences(e):this._invalidateReference(e)):(this.log.warn({msg:"acd/storage/memory.invalidate, exit due invalidation is disabled"}),[])}_invalidateReferences(e){let t=[];for(let r=0;r<e.length;r++){let n=e[r],i=this.referencesKeys.get(n);if(this.log.debug({msg:"acd/storage/memory._invalidateReferences, remove keys on reference",reference:n,keys:i}),i){for(let e=0;e<i.length;e++){let r=i[e];this.log.debug({msg:"acd/storage/memory._invalidateReferences, remove key on reference",reference:n,key:r}),this._removeKey(r)&&t.push(r)}this.log.debug({msg:"acd/storage/memory._invalidateReferences, remove references of",reference:n,keys:i}),this._removeReferences([...i])}}return t}_invalidateReference(e){if(e.includes("*")){let t=[];for(let r of this.referencesKeys.keys())T(e,r)&&t.push(r);return this._invalidateReferences(t)}let t=this.referencesKeys.get(e),r=[];if(this.log.debug({msg:"acd/storage/memory._invalidateReference, remove keys on reference",reference:e,keys:t}),!t)return r;for(let n=0;n<t.length;n++){let i=t[n];this.log.debug({msg:"acd/storage/memory._invalidateReference, remove key on reference",reference:e,key:i}),this._removeKey(i)&&r.push(i)}return this.log.debug({msg:"acd/storage/memory._invalidateReference, remove references of",reference:e,keys:t}),this._removeReferences([...t]),r}clear(e){if(this.log.debug({msg:"acd/storage/memory.clear",name:e}),!e){if(this.store.clear(),!this.invalidation)return;return this.referencesKeys.clear(),void this.keysReferences.clear()}let t=[];this.store.forEach((r,n)=>{this.log.debug({msg:"acd/storage/memory.clear, iterate key",key:n}),0===n.indexOf(e)&&(this.log.debug({msg:"acd/storage/memory.clear, remove key",key:n}),t.push(n))});let r=[];for(let e=0;e<t.length;e++)this._removeKey(t[e])&&r.push(t[e]);return this._removeReferences(r),r}refresh(){this.log.debug({msg:"acd/storage/memory.refresh"}),this.init()}};let{isServerSide:L}=d;L&&(i=function(){if(h)return c;h=1;let e=g,{findNotMatching:t,randomSubset:r,abstractLogging:n}=d;return c=class extends e{constructor(e={}){if(!e.client||"object"!=typeof e.client)throw Error("Redis client is required");if(super(e),e.invalidation&&e.invalidation.referencesTTL&&("number"!=typeof e.invalidation.referencesTTL||e.invalidation.referencesTTL<1))throw Error("invalidation.referencesTTL must be a positive integer greater than 1");this.log=e.log||n(),this.store=e.client,this.invalidation=!!e.invalidation,this.referencesTTL=e.invalidation&&e.invalidation.referencesTTL||60}getReferenceKeyLabel(e){return`r:${e}`}getKeyReferenceLabel(e){return`k:${e}`}async get(e){this.log.debug({msg:"acd/storage/redis.get",key:e});try{let t=await this.store.get(e);if(!t){if(!this.invalidation)return;return void this.clearReferences(e)}return JSON.parse(t)}catch(t){this.log.error({msg:"acd/storage/redis.get error",err:t,key:e})}}async getTTL(e){this.log.debug({msg:"acd/storage/memory.getTTL",key:e});let t=await this.store.pttl(e);return t<0?0:t=Math.ceil(t/1e3)}async set(e,r,n,i){if(this.log.debug({msg:"acd/storage/redis.set key",key:e,value:r,ttl:n,references:i}),(n=Number(n))&&!(n<0))try{if(await this.store.set(e,u(r),"EX",n),!i||i.length<1)return;if(!this.invalidation)return void this.log.warn({msg:"acd/storage/redis.set, invalidation is disabled, references are useless",key:e,references:i});let s=[],o=await this.store.smembers(this.getKeyReferenceLabel(e));if(this.log.debug({msg:"acd/storage/redis.set current references",key:e,currentReferences:o}),o.length>1){for(let r of(o.sort(),i.sort(),t(i,o)))s.push(["srem",this.getReferenceKeyLabel(r),e]);s.push(["del",this.getKeyReferenceLabel(e)])}let a=o.length>1?t(o,i):i;this.log.debug({msg:"acd/storage/redis.set references to add",key:e,referencesToAdd:a});for(let t=0;t<a.length;t++){let r=a[t],n=this.getReferenceKeyLabel(r);s.push(["sadd",n,e]),s.push(["expire",n,this.referencesTTL])}let l=this.getKeyReferenceLabel(e);s.push(["sadd",l,i]),s.push(["expire",l,n]),this.log.debug({msg:"acd/storage/redis.set references writes",writes:s}),await this.store.pipeline(s).exec()}catch(t){this.log.error({msg:"acd/storage/redis.set error",err:t,key:e,ttl:n,references:i})}}async remove(e){this.log.debug({msg:"acd/storage/redis.remove",key:e});try{let t=await this.store.del(e)>0;return t&&this.invalidation&&await this.clearReferences(e),t}catch(t){this.log.error({msg:"acd/storage/redis.remove error",err:t,key:e})}}async invalidate(e){if(!this.invalidation)return this.log.warn({msg:"acd/storage/redis.invalidate, exit due invalidation is disabled"}),[];this.log.debug({msg:"acd/storage/redis.invalidate",references:e});try{return Array.isArray(e)?await this._invalidateReferences(e):await this._invalidateReference(e)}catch(t){return this.log.error({msg:"acd/storage/redis.invalidate error",err:t,references:e}),[]}}async _invalidateReferences(e,t=!0){let r=e.map(e=>["smembers",t?this.getReferenceKeyLabel(e):e]),n=await this.store.pipeline(r).exec();this.log.debug({msg:"acd/storage/redis._invalidateReferences keys",keys:n});let i=[],s=[];for(let e=0;e<n.length;e++){let t=n[e][1];if(t){this.log.debug({msg:"acd/storage/redis._invalidateReferences got keys to be invalidated",keys:t});for(let e=0;e<t.length;e++){let r=t[e];this.log.debug({msg:"acd/storage/redis._invalidateReferences del key"+r}),s.push(r),i.push(["del",r])}}}return await this.store.pipeline(i).exec(),await this.clearReferences(s),s}async _invalidateReference(e){let t;if(e.includes("*")){let t=await this.store.keys(this.getReferenceKeyLabel(e));return this._invalidateReferences(t,!1)}t=await this.store.smembers(this.getReferenceKeyLabel(e)),this.log.debug({msg:"acd/storage/redis._invalidateReference keys",keys:t});let r=[],n=[];for(let e=0;e<t.length;e++){let i=t[e];this.log.debug({msg:"acd/storage/redis._invalidateReference del key"+i}),n.push(i),r.push(["del",i])}return await this.store.pipeline(r).exec(),await this.clearReferences(n),n}async clear(e){this.log.debug({msg:"acd/storage/redis.clear",name:e});try{if(!e)return void await this.store.flushall();let t=await this.store.keys(`${e}*`);this.log.debug({msg:"acd/storage/redis.clear keys",keys:t});let r=t.map(e=>["del",e]);if(await this.store.pipeline(r).exec(),!this.invalidation)return;await this.clearReferences(t)}catch(t){this.log.error({msg:"acd/storage/redis.clear error",err:t,name:e})}}async refresh(){try{await this.store.flushall()}catch(e){this.log.error({msg:"acd/storage/redis.refresh error",err:e})}}async clearReferences(e){try{if(!e)return void this.log.warn({msg:"acd/storage/redis.clearReferences invalid call due to empty key"});Array.isArray(e)||(e=[e]);let t=e.map(e=>["smembers",this.getKeyReferenceLabel(e)]),r=await this.store.pipeline(t).exec();this.log.debug({msg:"acd/storage/redis.clearReferences references",keys:e,referencesKeys:r});let n={};for(let t=0;t<e.length;t++){for(let i=0;i<r[t][1].length;i++){let s=this.getReferenceKeyLabel(r[t][1][i]);n[s]||(n[s]=["srem",s,e])}let i=this.getKeyReferenceLabel(e[t]);n[i]=["del",i]}this.log.debug({msg:"acd/storage/redis.clearReferences writes pipeline",writes:n}),await this.store.pipeline(Object.values(n)).exec()}catch(e){this.log.error({msg:"acd/storage/redis.clearReferences error",err:e})}}async gc(e="lazy",t={}){if(this.log.debug({msg:"acd/storage/redis.gc",mode:e,options:t}),!this.invalidation)return void this.log.warn({msg:"acd/storage/redis.gc does not run due to invalidation is disabled"});"strict"!==e&&"lazy"!==e&&(e="lazy");let n={references:{scanned:[],removed:[]},keys:{scanned:new Set,removed:new Set},loops:0,cursor:0,error:null};try{let i=0,s=64;if(t.chunk&&("number"!=typeof t.chunk||t.chunk<1))return n.error=Error("chunk must be a positive integer greater than 1"),n;if(t.lazy){if(t.lazy.chunk){if("number"!=typeof t.lazy.chunk||t.lazy.chunk<1)return n.error=Error("lazy.chunk must be a positive integer greater than 1"),n;s=t.lazy.chunk}if(t.lazy.cursor){if("number"!=typeof t.lazy.cursor||t.lazy.cursor<0)return n.error=Error("lazy.cursor must be a positive integer greater than 0"),n;i=t.lazy.cursor}}let o=t.chunk||64,a=Math.min(s,o),l=i,u=-1,f=-1;do{n.loops++;let t=await this.store.scan(i,"match","r:*","count",a);i=Number(t[0]),u=t[1].length;let o="lazy"===e?r(t[1],s):t[1];n.references.scanned=n.references.scanned.concat(o);let l=[];for(let e=0;e<o.length;e++){let t=o[e];l.push(["smembers",t])}let c=await this.store.pipeline(l).exec(),h={},d={};for(let e=0;e<c.length;e++){let t=c[e],r=o[e];d[r]=t[1];for(let e=0;e<t[1].length;e++){let i=t[1][e];h[i]?h[i].push(r):h[i]=[r],n.keys.scanned.add(i)}}let g=Object.keys(h);l=g.map(e=>["exists",e]);let y=await this.store.pipeline(l).exec(),p={};for(let e=0;e<g.length;e++){let t=g[e];if(1!==y[e][1])for(let e=0;e<h[t].length;e++){let r=h[t][e];p[r]?p[r].push(t):p[r]=[t],n.keys.removed.add(t)}}let m=Object.keys(p),v=[];for(let e=0;e<m.length;e++){let t=m[e];d[t].length===p[t].length?(v.push(["del",t]),n.references.removed.push(t)):v.push(["srem",t,p[t]])}if(await this.store.pipeline(v).exec(),f=v.length,"lazy"===e&&n.references.scanned.length>=s)break}while(l!==i&&u>0&&f>0);n.cursor=i,n.keys.scanned=Array.from(n.keys.scanned),n.keys.removed=Array.from(n.keys.removed)}catch(e){this.log.error({msg:"acd/storage/redis.gc error",err:e}),n.error=e}return n}}}());let z="redis";var P=function(e,t){if(!L&&e===z)throw Error("Redis storage is not supported in the browser");return e===z?new i(t):new j(t)};let{kValues:N,kStorage:U,kStorages:I,kTransfromer:C,kTTL:F,kOnDedupe:V,kOnError:J,kOnHit:D,kOnMiss:q,kStale:B}=a;class H{constructor(e,t,r,n,i,s,o,a,l,u,f,c){this.dedupes=new Map,this.func=e,this.name=t,this.serialize=r,this.references=n,this.storage=i,this.transformer=s,this.ttl=o,this.onDedupe=a,this.onError=l,this.onHit=u,this.onMiss=f,this.stale=c}getKey(e){let t=this.serialize?this.serialize(e):e;return"string"==typeof t?t:u(t)}getStorageKey(e){return`${this.name}~${e}`}getStorageName(){return`${this.name}~`}add(e){try{let t=this.getKey(e),r=this.dedupes.get(t);return r?this.onDedupe(t):(r=new W,this.buildPromise(r,e,t),this.dedupes.set(t,r)),r.promise}catch(e){this.onError(e)}}async wrapFunction(e,t){let r=this.getStorageKey(t);if(this.ttl>0||"function"==typeof this.ttl){let n=await this.get(r);if(void 0!==n){this.onHit(t);let i="function"==typeof this.stale?this.stale(n):this.stale;return i>0&&await this.storage.getTTL(r)<=i&&this._wrapFunction(r,e,t).catch(Y),n}this.onMiss(t)}return this._wrapFunction(r,e,t)}async _wrapFunction(e,t,r){let n=await this.func(t,r),i="function"==typeof this.stale?this.stale(n):this.stale,s="function"==typeof this.ttl?this.ttl(n):this.ttl;if(null==s||"number"!=typeof s||!Number.isInteger(s))return this.onError(Error("ttl must be an integer")),n;if((s+=i)<1)return n;if(!this.references)return await this.set(e,n,s),n;try{let i=this.references(t,r,n),o=n;i&&"function"==typeof i.then&&(i=await i),this.transformer&&(o=this.transformer.serialize(n)),await this.storage.set(e,o,s,i)}catch(e){this.onError(e)}return n}buildPromise(e,t,r){e.promise=this.wrapFunction(t,r),e.promise.then(e=>(this.dedupes.delete(r),e)).catch(e=>{this.onError(e),this.dedupes.delete(r);let t=this.storage.remove(this.getStorageKey(r));t&&"function"==typeof t.catch&&t.catch(Y)})}async clear(e){if(e){let t=this.getKey(e);return this.dedupes.delete(t),void await this.storage.remove(this.getStorageKey(t))}await this.storage.clear(this.getStorageName()),this.dedupes.clear()}async get(e){let t=await this.storage.get(e);return this.transformer&&t?await this.transformer.deserialize(t):t}async set(e,t,r,n){return this.transformer&&(t=this.transformer.serialize(t)),this.storage.set(e,t,r,n)}async invalidate(e){return this.storage.invalidate(e)}}class W{constructor(){this.promise=null}}function Y(){}o.Cache=class{constructor(e={}){if(!e.storage)throw Error("storage is required");if(e.ttl&&"number"==typeof e.ttl&&(e.ttl<0||!Number.isInteger(e.ttl)))throw Error("ttl must be a positive integer greater than 0");if(e.onDedupe&&"function"!=typeof e.onDedupe)throw Error("onDedupe must be a function");if(e.onError&&"function"!=typeof e.onError)throw Error("onError must be a function");if(e.onHit&&"function"!=typeof e.onHit)throw Error("onHit must be a function");if(e.onMiss&&"function"!=typeof e.onMiss)throw Error("onMiss must be a function");if("number"==typeof e.stale&&!(Math.floor(e.stale)===e.stale&&e.stale>=0))throw Error("stale must be an integer greater or equal to 0");this[N]={},this[U]=e.storage,this[I]=new Map,this[I].set("_default",e.storage),this[C]=e.transformer,this[F]=e.ttl||0,this[V]=e.onDedupe||Y,this[J]=e.onError||Y,this[D]=e.onHit||Y,this[q]=e.onMiss||Y,this[B]=e.stale||0}define(e,t,r){let n;if("function"==typeof t&&(r=t,t={}),e&&this[e])throw Error(`${e} is already defined in the cache or it is a forbidden name`);if(t=t||{},"function"!=typeof r)throw TypeError(`Missing the function parameter for '${e}'`);let i=t.serialize;if(i&&"function"!=typeof i)throw TypeError("serialize must be a function");let s=t.references;if(s&&"function"!=typeof s)throw TypeError("references must be a function");if("function"!=typeof t.ttl&&t.ttl&&("number"!=typeof t.ttl||t.ttl<0||!Number.isInteger(t.ttl)))throw Error("ttl must be a positive integer greater than 0");t.storage?(n=P(t.storage.type,t.storage.options),this[I].set(e,n)):n=this[U];let o=void 0!==t.ttl?t.ttl:this[F],a=void 0!==t.stale?t.stale:this[B],l=t.onDedupe||this[V],u=t.onError||this[J],f=t.onHit||this[D],c=t.onMiss||this[q],h=t.transformer||this[C],d=new H(r,e,i,s,n,h,o,l,u,f,c,a);return this[N][e]=d,this[e]=d.add.bind(d),this}async clear(e,t){if(e){if(!this[N][e])throw Error(`${e} is not defined in the cache`);return void await this[N][e].clear(t)}let r=[];for(let e of Object.values(this[N]))r.push(e.clear());await Promise.all(r)}async get(e,t){if(!this[N][e])throw Error(`${e} is not defined in the cache`);return this[N][e].get(t)}async set(e,t,r,n,i){if(!this[N][e])throw Error(`${e} is not defined in the cache`);return this[N][e].set(t,r,n,i)}async invalidate(e,t){if(!this[N][e])throw Error(`${e} is not defined in the cache`);return this[N][e].invalidate(t)}async invalidateAll(e,t="_default"){if(!this[I].has(t))throw Error(`${t} storage is not defined in the cache`);await this[I].get(t).invalidate(e)}};let{Cache:Q}=o;var X=function(e){e?e.storage||(e.storage={type:"memory"}):e={storage:{type:"memory"}};let t=P(e.storage.type,e.storage.options);return new Q({...e,storage:t})};let Z=0,G=[];Symbol("clean");let ee=[],et=(e,t)=>{let r=[],n={get:()=>(n.lc||n.listen(()=>{})(),n.value),l:t||0,lc:0,listen:(e,t)=>(n.lc=r.push(e,t||n.l)/2,()=>{let t=r.indexOf(e);~t&&(r.splice(t,2),--n.lc||n.off())}),notify(e,t){let i=!ee.length;for(let i=0;i<r.length;i+=2)ee.push(r[i],r[i+1],n.value,e,t);if(i){for(let e=0;e<ee.length;e+=5){let t;for(let r=e+1;!t&&(r+=5)<ee.length;)ee[r]<ee[e+1]&&(t=ee.push(ee[e],ee[e+1],ee[e+2],ee[e+3],ee[e+4]));t||ee[e](ee[e+2],ee[e+3],ee[e+4])}ee.length=0}},off(){},set(e){let t=n.value;t!==e&&(n.value=e,n.notify(t))},subscribe(e,t){let r=n.listen(e,t);return e(n.value),r},value:e};return n},er=typeof document>"u"?"server":"browser";function en(e){return e.withConfig({allowReconfigure:!1})}let ei=e=>{let{ssr:t=!1,tag:n="core-loader"}=e;if(t&&e.client)throw TypeError("`client` option is not allowed when `ssr: true`, use `setServerClient` from your server entry point instead");if(!t&&!1===e.client)throw TypeError("You must set `ssr: true` when `client: false` is used");if(!t&&!e.client)throw TypeError("`client` is required");let i=t?void 0:en(e.client);function s(e){return X().define("fetch",async t=>{if(!e)throw Error("You have to set the Sanity client with `setServerClient` before any data fetching is done");let{query:r,params:i={},perspective:s,useCdn:o}=JSON.parse(t),{result:a,resultSourceMap:l}=await e.fetch(r,i,{tag:n,filterResponse:!1,perspective:s,useCdn:o});return{result:a,resultSourceMap:l}})}function o(){let e=(null==i?void 0:i.config().perspective)||"published";return a.instance=s(i),{hydrate:(t,r,n)=>({loading:void 0===(null==n?void 0:n.data)||void 0===(null==n?void 0:n.sourceMap),error:void 0,data:null==n?void 0:n.data,sourceMap:null==n?void 0:n.sourceMap,perspective:e}),fetch:(t,r,n,i)=>{if(i.signal.aborted)return;let s=(Z+=1,()=>{if(0==(Z-=1)){let e=G;for(let t of(G=[],e))t()}});n.setKey("loading",!0),n.setKey("error",void 0),a.instance.fetch(JSON.stringify({query:t,params:r})).then(t=>{i.signal.aborted||(n.setKey("data",t.result),n.setKey("sourceMap",t.resultSourceMap),n.setKey("perspective",e))}).catch(e=>{n.setKey("error",e)}).finally(()=>{n.setKey("loading",!1),s()})}}}let a={instance:s(i)},l=et(i?o():void 0),u=(e=>{let{ssr:t,setFetcher:n}=e;return i=>{let s;if("server"===er)throw Error("Live mode is not supported in server environments");if(t&&!i.client)throw Error("The `client` option in `enableLiveMode` is required");let o=i.client||e.client||void 0,a=new AbortController;return Promise.all([r.e(4181),r.e(6267)]).then(r.bind(r,66267)).then(({enableLiveMode:e})=>{a.signal.aborted||(s=e({...i,client:o,setFetcher:n,ssr:t}))}),()=>{a.abort(),null==s||s()}}})({client:i||void 0,ssr:t,setFetcher:e=>{let t=l.get();return l.set(e),()=>l.set(t)}}),f={instance:void 0,canPreviewDrafts:!1};return{createFetcherStore:(e,t={},r)=>{var n,i,s,o,a;let u=l.get(),f=((e={})=>{let t=et(e);return t.setKey=function(e,r){let n=t.value;typeof r>"u"&&e in t.value?(t.value={...t.value},delete t.value[e],t.notify(n,e)):t.value[e]!==r&&(t.value={...t.value,[e]:r},t.notify(n,e))},t})(u?u.hydrate(e,t,r):{loading:!1,error:typeof(null==r?void 0:r.data)>"u"?Error("The `initial` option is required when `ssr: true`"):void 0,data:null==r?void 0:r.data,sourceMap:null==r?void 0:r.sourceMap,perspective:null==r?void 0:r.perspective});return i=()=>{let r=new AbortController,n=l.subscribe(n=>{!n||r.signal.aborted||(r.abort(),r=new AbortController,n.fetch(e,t,f,r))});return()=>{r.abort(),n()}},o=e=>{let t=i(e);t&&n.events[6].push(t)},a=e=>{let t=n.listen;n.listen=(...r)=>(n.lc||n.active||(n.active=!0,e()),t(...r));let r=n.off;return n.events[6]=[],n.off=()=>{r(),setTimeout(()=>{if(n.active&&!n.lc){for(let e of(n.active=!1,n.events[6]))e();n.events[6]=[]}},1e3)},()=>{n.listen=t,n.off=r}},(s=n=f).events=s.events||{},s.events[15]||(s.events[15]=a(e=>{s.events[5].reduceRight((e,t)=>(t(e),e),{shared:{},...e})})),s.events[5]=s.events[5]||[],s.events[5].push(o),f},enableLiveMode:u,setServerClient:e=>{if("server"!==er)throw Error("`setServerClient` can only be called in server environments, detected: "+JSON.stringify(er));if(!t)throw Error("`setServerClient` can only be called when `ssr: true`");f.instance=i=en(e),f.canPreviewDrafts=!!i.config().token,l.set(o())},unstable__cache:a,unstable__serverClient:f}}},57365:function(e,t,r){r.d(t,{Jt:function(){return k},aM:function(){return S}});var n,i,s,o,a=r(29104),l=r(2265),u=r(11726);function f(e,t,r,n,a){var l,u,f,c,h,d,g,y,p,m,v,b,w,k;let S;let $=a&&"input"in a?a.input:r.value,E=null!=(l=null==a?void 0:a.expected)?l:e.expects,_=null!=(u=null==a?void 0:a.received)?u:("object"==(S=typeof $)&&(S=null!=(m=$&&(null==(p=null==(y=Object.getPrototypeOf($))?void 0:y.constructor)?void 0:p.name))?m:"null"),"string"===S?`"${$}"`:"number"===S||"bigint"===S||"boolean"===S?`${$}`:S),A={kind:e.kind,type:e.type,input:$,expected:E,received:_,message:`Invalid ${t}: ${E?`Expected ${E} but r`:"R"}eceived ${_}`,requirement:e.requirement,path:null==a?void 0:a.path,issues:null==a?void 0:a.issues,lang:n.lang,abortEarly:n.abortEarly,abortPipeEarly:n.abortPipeEarly,skipPipe:n.skipPipe},O="schema"===e.kind,R=null!=(d=null!=(h=null!=(c=null!=(f=e.message)?f:(v=e.reference,b=A.lang,null==(w=null==o?void 0:o.get(v))?void 0:w.get(b)))?c:O?(g=A.lang,null==s?void 0:s.get(g)):null)?h:n.message)?d:(k=A.lang,null==i?void 0:i.get(k));R&&(A.message="function"==typeof R?R(A):R),O&&(r.typed=!1),r.issues?r.issues.push(A):r.issues=[A]}function c(e,t){return{kind:"schema",type:"object",reference:c,expects:"Object",async:!1,entries:e,message:t,_run(e,t){var r;let n=e.value;if(n&&"object"==typeof n)for(let i in e.typed=!0,e.value={},this.entries){let s=n[i],o=this.entries[i]._run({typed:!1,value:s},t);if(o.issues){let a={type:"object",origin:"value",input:n,key:i,value:s};for(let t of o.issues)t.path?t.path.unshift(a):t.path=[a],null==(r=e.issues)||r.push(t);if(e.issues||(e.issues=o.issues),t.abortEarly){e.typed=!1;break}}o.typed||(e.typed=!1),(void 0!==o.value||i in n)&&(e.value[i]=o.value)}else f(this,"type",e,t);return e}}}function h(e,...t){let r={kind:"schema",type:"optional",reference:h,expects:`${e.expects} | undefined`,async:!1,wrapped:e,_run(e,t){return void 0===e.value&&("default"in this&&(e.value="function"==typeof this.default?this.default(e,t):this.default),void 0===e.value)?(e.typed=!0,e):this.wrapped._run(e,t)}};return 0 in t&&(r.default=t[0]),r}function d(e){return{kind:"schema",type:"string",reference:d,expects:"string",async:!1,message:e,_run(e,t){return"string"==typeof e.value?e.typed=!0:f(this,"type",e,t),e}}}let g=function(...e){return{...e[0],pipe:e,_run(t,r){for(let n=0;n<e.length;n++){t=e[n]._run(t,r);let i=e[n+1];if(r.skipPipe||t.issues&&(r.abortEarly||r.abortPipeEarly||"schema"===(null==i?void 0:i.kind)||"transformation"===(null==i?void 0:i.kind))){t.typed=!1;break}}return t}}}(d(),function e(t,r){return{kind:"validation",type:"min_length",reference:e,async:!1,expects:`>=${t}`,requirement:t,message:r,_run(e,t){return e.typed&&e.value.length<this.requirement&&f(this,"length",e,t,{received:`${e.value.length}`}),e}}}(1)),y=h(g),p=c({baseUrl:g,dataset:y,id:g,path:g,projectId:y,tool:y,type:y,workspace:y,isDraft:h(d())});c({origin:g,href:g,data:h(function e(t,r,n){return{kind:"schema",type:"record",reference:e,expects:"Object",async:!1,key:t,value:r,message:n,_run(e,t){var r,n;let i=e.value;if(i&&"object"==typeof i){for(let s in e.typed=!0,e.value={},i)if("__proto__"!==s&&"prototype"!==s&&"constructor"!==s){let o=i[s],a=this.key._run({typed:!1,value:s},t);if(a.issues){let n={type:"record",origin:"key",input:i,key:s,value:o};for(let t of a.issues)t.path=[n],null==(r=e.issues)||r.push(t);if(e.issues||(e.issues=a.issues),t.abortEarly){e.typed=!1;break}}let l=this.value._run({typed:!1,value:o},t);if(l.issues){let r={type:"record",origin:"value",input:i,key:s,value:o};for(let t of l.issues)t.path?t.path.unshift(r):t.path=[r],null==(n=e.issues)||n.push(t);if(e.issues||(e.issues=l.issues),t.abortEarly){e.typed=!1;break}}a.typed&&l.typed||(e.typed=!1),a.typed&&(e.value[a.value]=l.value)}}else f(this,"type",e,t);return e}}}(d(),function e(){return{kind:"schema",type:"unknown",reference:e,expects:"unknown",async:!1,_run:e=>(e.typed=!0,e)}}()))});let m=(e,t,r,n)=>{if(!t||!r)return;let i=(0,u.dK)(n),s=(0,u.Vq)({resultPath:i,resultSourceMap:t,studioUrl:r});return s?function(e){let{id:t,path:r,baseUrl:n,tool:i,workspace:s,type:o}=e;return p._run({typed:!1,value:e},{abortEarly:!0}).issues?void 0:[["id",(0,u.vs)(t)],["type",o],["path",function(e){let t="";for(let r of e)"string"!=typeof r?"number"!=typeof r?null!==r&&Array.isArray(r)?(t&&(t+=":"),t+=`${r.join(",")}}`):r._key&&(t&&(t+=":"),t+=`${r._key}`):(t&&(t+=":"),t+=`${r}`):(t&&(t+="."),t+=r);return t}(u.eT.fromString(r))],["base",encodeURIComponent(n)],["workspace",s],["tool",i],["isDraft",t.startsWith("drafts.")]].filter(([,e])=>!!e).map(e=>{let[t,r]=e;return!0===r?t:e.join("=")}).join(";")}({baseUrl:s.baseUrl,workspace:s.workspace,tool:s.tool,type:s.type,id:s.id,path:"string"==typeof s.path?s.path:u.eT.toString((0,u.wC)(s.path))}):void 0};var v=(n=function e(t,r){if(t===r)return!0;if(t&&r&&"object"==typeof t&&"object"==typeof r){if(t.constructor!==r.constructor)return!1;if(Array.isArray(t)){if((n=t.length)!=r.length)return!1;for(i=n;0!=i--;)if(!e(t[i],r[i]))return!1;return!0}if(t.constructor===RegExp)return t.source===r.source&&t.flags===r.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===r.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===r.toString();if((n=(s=Object.keys(t)).length)!==Object.keys(r).length)return!1;for(i=n;0!=i--;)if(!Object.prototype.hasOwnProperty.call(r,s[i]))return!1;for(i=n;0!=i--;){var n,i,s,o=s[i];if(!e(t[o],r[o]))return!1}return!0}return t!=t&&r!=r}).__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n;let{loadQuery:b,setServerClient:w,useLiveMode:k,useQuery:S}=(e=>{let{createFetcherStore:t,enableLiveMode:r}=(0,a.c)({tag:"react-loader",...e}),n=function(e){let t="object"==typeof e?null==e?void 0:e.config().stega.studioUrl:void 0,r=t,n=new Set;return{subscribe:e=>(n.add(e),()=>n.delete(e)),getSnapshot:()=>t,getServerSnapshot:()=>r,setStudioUrl(e){t=e,n.forEach(e=>e())}}}(e.client);return{loadQuery:()=>{throw Error("The `loadQuery` function is server only.")},useQuery:function({createFetcherStore:e,studioUrlStore:t}){let r={};return(n,i=r,s={})=>{var o,a;let f=(0,l.useMemo)(()=>s.initial?{perspective:"published",...s.initial}:void 0,[s.initial]),c=(0,l.useMemo)(()=>JSON.stringify(i),[i]),[h,d]=(0,l.useState)(()=>e(n,JSON.parse(c),f).value);(0,l.useEffect)(()=>{let t=e(n,JSON.parse(c),f).subscribe(e=>{d(t=>v(t.sourceMap,e.sourceMap)&&v(t.data,e.data)&&t.error===e.error&&t.loading===e.loading&&t.perspective===e.perspective?t:e)});return()=>t()},[c,f,n]);let g=(0,l.useSyncExternalStore)(t.subscribe,t.getSnapshot,t.getServerSnapshot),y=(o=h.data,a=h.sourceMap,(0,l.useMemo)(()=>(function e(t,r,n,i){let s=e=>e?"string"==typeof e?u.eT.fromString(e):e:[],o=s(i);return Object.assign(e=>m(0,r,n,[...o,...s(e)]),{scope:i=>e(t,r,n,[...o,...s(i)])})})(o,a,g),[o,a,g]));return(0,l.useMemo)(()=>({...h,encodeDataAttribute:y}),[h,y])}}({createFetcherStore:t,studioUrlStore:n}),setServerClient:()=>{throw Error("The `setServerClient` function is server only.")},useLiveMode:function({enableLiveMode:e,setStudioUrl:t}){return({allowStudioOrigin:r,client:n,onConnect:i,onDisconnect:s,studioUrl:o})=>{(0,l.useEffect)(()=>{r&&console.warn("`allowStudioOrigin` is deprecated and no longer needed");let t=e({client:n,onConnect:i,onDisconnect:s});return()=>t()},[r,n,i,s]),(0,l.useEffect)(()=>{t((null!=o?o:"object"==typeof n)?null==n?void 0:n.config().stega.studioUrl:void 0)},[o,n])}}({enableLiveMode:r,setStudioUrl:n.setStudioUrl})}})({client:!1,ssr:!0})}}]);